---
title: 46. async/await
categories: [StudyLog, Javascript]
tags: [javascript]
thumbnailImage: js.png
date: 2020-11-15 15:51:37
---

<!-- more -->
async/awaitì€ ê°€ë…ì„± ì¢‹ê²Œ ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ ë™ê¸° ì²˜ë¦¬ì²˜ëŸ¼ ë™ì‘í•˜ë„ë¡ êµ¬í˜„í•˜ê¸° ìœ„í•´ ë„ì…ë˜ì—ˆë‹¤. asycnì™€ await í•¨ìˆ˜ì— ëŒ€í•´ ì•Œì•„ë³´ì.
<!-- excerpt -->
<!-- toc -->

# 1. async/await

- async/awaitì€ ê°€ë…ì„± ì¢‹ê²Œ ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ ë™ê¸° ì²˜ë¦¬ì²˜ëŸ¼ ë™ì‘í•˜ë„ë¡ êµ¬í˜„í•˜ê¸° ìœ„í•´ ë„ì…ë˜ì—ˆë‹¤.
- async/awaitëŠ” í”„ë¡œë¯¸ìŠ¤ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë™ì‘í•œë‹¤. async/awaitë¥¼ ì‚¬ìš©í•˜ë©´ í”„ë¡œë¯¸ìŠ¤ì˜ then/catch/finally í›„ì† ì²˜ë¦¬ ë©”ì„œë“œ ì—†ì´ ë§ˆì¹˜ ë™ê¸° ì²˜ë¦¬ì²˜ëŸ¼ í”„ë¡œë¯¸ìŠ¤ê°€ ì²˜ë¦¬ ê²°ê³¼ë¥¼ ë°˜í™˜í•˜ë„ë¡ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤. 

## 1.1. async í•¨ìˆ˜

- await í‚¤ì›Œë“œëŠ” ë°˜ë“œì‹œ async í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ ì‚¬ìš©í•´ì•¼ í•œë‹¤. 
- async í•¨ìˆ˜ëŠ” async í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•´ ì •ì˜í•˜ë©° ì–¸ì œë‚˜ í”„ë¡œë¯¸ìŠ¤ë¥¼ ë°˜í™˜í•œë‹¤.
(tip) í•¨ìˆ˜ì˜ ë§¨ ì•ì— ë¶™ì—¬ì¤„ ê²ƒ!
- í´ë˜ìŠ¤ì˜ constructor ë©”ì„œë“œëŠ” async ë©”ì„œë“œê°€ ë  ìˆ˜ ì—†ë‹¤. í´ë˜ìŠ¤ì˜ constructor ë©”ì„œë“œëŠ” ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°˜í™˜í•´ì•¼ í•˜ì§€ë§Œ async í•¨ìˆ˜ëŠ” ì–¸ì œë‚˜ í”„ë¡œë¯¸ìŠ¤ë¥¼ ë°˜í™˜í•´ì•¼ í•œë‹¤.

```js
// async í•¨ìˆ˜ ì„ ì–¸ë¬¸
async function foo(n) { return n; }
foo(1).then(v => console.log(v)); // 1

// async í•¨ìˆ˜ í‘œí˜„ì‹
const bar = async function (n) { return n; };
bar(2).then(v => console.log(v)); // 2

// async í™”ì‚´í‘œ í•¨ìˆ˜
const baz = async n => n;
baz(3).then(v => console.log(v)); // 3

// async ë©”ì„œë“œ
const obj = {
  async foo(n) { return n; }
};
obj.foo(4).then(v => console.log(v)); // 4

// async í´ë˜ìŠ¤ ë©”ì„œë“œ
class MyClass {
  async bar(n) { return n; }
}
const myClass = new MyClass();
myClass.bar(5).then(v => console.log(v)); // 5
```
<br>



## 1.2. await í•¨ìˆ˜

- await í‚¤ì›Œë“œëŠ” í”„ë¡œë¯¸ìŠ¤ê°€ settled ìƒíƒœ(ë¹„ë™ê¸° ì²˜ë¦¬ê°€ ìˆ˜í–‰ëœ ìƒíƒœ)ê°€ ë  ë•Œê¹Œì§€ ëŒ€ê¸°í•˜ë‹¤ê°€ settled ìƒíƒœê°€ ë˜ë©´ í”„ë¡œë¯¸ìŠ¤ê°€ resolveí•œ ì²˜ë¦¬ ê²°ê³¼ë¥¼ ë°˜í™˜í•œë‹¤.
- await í‚¤ì›Œë“œëŠ” ë‹¤ìŒ ì‹¤í–‰ì„ ì¼ì‹œ ì¤‘ì§€ì‹œì¼°ë‹¤ê°€ í”„ë¡œë¯¸ìŠ¤ê°€ settled ìƒíƒœê°€ ë˜ë©´ ë‹¤ì‹œ ì¬ê°œí•œë‹¤.
- await í‚¤ì›Œë“œëŠ” ë°˜ë“œì‹œ í”„ë¡œë¯¸ìŠ¤ ì•ì—ì„œ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

<br>

ì•„ë˜ ì˜ˆì œì—ì„œ â‘ ì˜ fetch í•¨ìˆ˜ê°€ ìˆ˜í–‰í•œ HTTP ìš”ì²­ì— ëŒ€í•œ ì„œë²„ì˜ ì‘ë‹µì´ ë„ì°©í•´ì„œ fetch í•¨ìˆ˜ê°€ ë°˜í™˜í•œ í”„ë¡œë¯¸ìŠ¤ê°€ settled ìƒíƒœê°€ ë  ë•Œê¹Œì§€ â‘ ì€ ëŒ€ê¸°í•˜ê²Œ ëœë‹¤. **ì´í›„ í”„ë¡œë¯¸ìŠ¤ê°€ settled ìƒíƒœê°€ ë˜ë©´ í”„ë¡œë¯¸ìŠ¤ê°€ resolveí•œ ì²˜ë¦¬ ê²°ê³¼ê°€ res ë³€ìˆ˜ì— í• ë‹¹ëœë‹¤.**

```js
const fetch = require('node-fetch');

const getGithubUserName = async id => {
  const res = await fetch(`https://api.github.com/users/${id}`); // â‘ 
  const { name } = await res.json(); // â‘¡
  console.log(name); // Ungmo Lee
};

getGithubUserName('ungmo2');
```
<br>

- (ğŸ”´ì£¼ì˜) ì—¬ëŸ¬ ê°œì˜ ë¹„ë™ê¸° ì²˜ë¦¬ê°€ ì—°ê´€ì´ ì—†ë‹¤ë©´ ìˆœì°¨ì ìœ¼ë¡œ ì²˜ë¦¬í•  í•„ìš”ê°€ ì—†ìœ¼ë¯€ë¡œ Promise.allì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ì¶”ì²œí•œë‹¤.
í•˜ì§€ë§Œ ë¹„ë™ê¸° ì²˜ë¦¬ì˜ ì²˜ë¦¬ ìˆœì„œê°€ ë³´ì¥ë˜ì–´ì•¼ í•  ë•ŒëŠ” await í‚¤ì›Œë“œë¥¼ ìˆœì„œëŒ€ë¡œ ì“´ë‹¤.

```js
// 1. ì²˜ë¦¬ ìˆœì„œì˜ ì—°ê´€ì´ ì—†ëŠ” ê²½ìš°
async function foo() {
  const res = await Promise.all([
    new Promise(resolve => setTimeout(() => resolve(1), 3000)),
    new Promise(resolve => setTimeout(() => resolve(2), 2000)),
    new Promise(resolve => setTimeout(() => resolve(3), 1000))
  ]);

  console.log(res); // [1, 2, 3]
}

foo(); // ì•½ 3ì´ˆ ì†Œìš”ëœë‹¤.


// 2. ì²˜ë¦¬ ìˆœì„œê°€ ë³´ì¥ë˜ì–´ì•¼ í•˜ëŠ” ê²½ìš°
async function bar(n) {
  const a = await new Promise(resolve => setTimeout(() => resolve(n), 3000));
  // ë‘ ë²ˆì§¸ ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ ìˆ˜í–‰í•˜ë ¤ë©´ ì²« ë²ˆì§¸ ë¹„ë™ê¸° ì²˜ë¦¬ ê²°ê³¼ê°€ í•„ìš”í•˜ë‹¤.
  const b = await new Promise(resolve => setTimeout(() => resolve(a + 1), 2000));
  // ì„¸ ë²ˆì§¸ ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ ìˆ˜í–‰í•˜ë ¤ë©´ ë‘ ë²ˆì§¸ ë¹„ë™ê¸° ì²˜ë¦¬ ê²°ê³¼ê°€ í•„ìš”í•˜ë‹¤.
  const c = await new Promise(resolve => setTimeout(() => resolve(b + 1), 1000));

  console.log([a, b, c]); // [1, 2, 3]
}

bar(1); // ì•½ 6ì´ˆ ì†Œìš”ëœë‹¤.
```

## 1.3. ì—ëŸ¬ì²˜ë¦¬

ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ ìœ„í•œ ì½œë°± íŒ¨í„´ì˜ ë‹¨ì  ì¤‘ ê°€ì¥ ì‹¬ê°í•œ ê²ƒì€ ì—ëŸ¬ ì²˜ë¦¬ê°€ ê³¤ë€í•˜ë‹¤ëŠ” ê²ƒì´ë‹¤. ë¹„ë™ê¸° í•¨ìˆ˜ì˜ ì½œë°± í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œ ê²ƒì€ ë¹„ë™ê¸° í•¨ìˆ˜ê°€ ì•„ë‹ˆê¸° ë•Œë¬¸ì— tryâ€¦catch ë¬¸ì„ ì‚¬ìš©í•´ ì—ëŸ¬ë¥¼ ìºì¹˜í•  ìˆ˜ ì—†ë‹¤. í•˜ì§€ë§Œ async/awaitì—ì„œ ì—ëŸ¬ ì²˜ë¦¬ëŠ” tryâ€¦catch ë¬¸ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. ì½œë°± í•¨ìˆ˜ë¥¼ ì¸ìˆ˜ë¡œ ì „ë‹¬ë°›ëŠ” ë¹„ë™ê¸° í•¨ìˆ˜ì™€ëŠ” ë‹¬ë¦¬ í”„ë¡œë¯¸ìŠ¤ë¥¼ ë°˜í™˜í•˜ëŠ” ë¹„ë™ê¸° í•¨ìˆ˜ëŠ” ëª…ì‹œì ìœ¼ë¡œ í˜¸ì¶œí•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— í˜¸ì¶œìê°€ ëª…í™•í•˜ë‹¤.

```js
const fetch = require('node-fetch');

const foo = async () => {
  try {
    const wrongUrl = 'https://wrong.url';

    const response = await fetch(wrongUrl);
    const data = await response.json();
    console.log(data);
  } catch (err) {
    console.error(err); // TypeError: Failed to fetch
  }
};

foo();
```
<br>

**async í•¨ìˆ˜ ë‚´ì—ì„œ catch ë¬¸ì„ ì‚¬ìš©í•´ì„œ ì—ëŸ¬ ì²˜ë¦¬ë¥¼ í•˜ì§€ ì•Šìœ¼ë©´ async í•¨ìˆ˜ëŠ” ë°œìƒí•œ ì—ëŸ¬ë¥¼ rejectí•˜ëŠ” í”„ë¡œë¯¸ìŠ¤ë¥¼ ë°˜í™˜í•œë‹¤.** ë”°ë¼ì„œ async í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê³  Promise.prototype.catch í›„ì† ì²˜ë¦¬ ë©”ì„œë“œë¥¼ ì‚¬ìš©í•´ ì—ëŸ¬ë¥¼ ìºì¹˜í•  ìˆ˜ë„ ìˆë‹¤.

```js
const fetch = require('node-fetch');

const foo = async () => {
  const wrongUrl = 'https://wrong.url';

  const response = await fetch(wrongUrl);
  const data = await response.json();
  return data;
};

foo()
  .then(console.log)
  .catch(console.error); // TypeError: Failed to fetch
```

<br>

---

**Reference**

- poiemaweb.com
